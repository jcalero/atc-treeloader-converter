<UserControl x:Class="atc_treeloader_converter.Controls.TechTreeDiagram"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewModels1="clr-namespace:atc_treeloader_converter.ViewModels"
             xmlns:converters="clr-namespace:atc_treeloader_converter.Converters"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="300">
	<UserControl.Resources>
		<converters:PosXToCanvasPointConverter x:Key="PosXToCanvasConverter"/>
		<converters:PosYToCanvasPointConverter x:Key="PosYToCanvasConverter"/>
		<converters:PointToCanvasPointConverter x:Key="PointToCanvasConverter"/>
	</UserControl.Resources>
	<UserControl.DataContext>
		<viewModels1:TechTreeViewModel/>
	</UserControl.DataContext>
	<Grid x:Name="TechTreeGrid" d:DataContext="{d:DesignInstance d:Type=viewModels1:TechTreeViewModel}">
		<ItemsControl Name="NodeConnectionsControl" ItemsSource="{Binding Connections}">
			<ItemsControl.ItemsPanel>
				<ItemsPanelTemplate>
					<Canvas VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
									Width="2600" Height="1500" Background="DarkSlateBlue">
						<Canvas.LayoutTransform>
							<ScaleTransform ScaleX="1" ScaleY="-1" CenterX=".5" CenterY=".5"/>
						</Canvas.LayoutTransform>
					</Canvas>
				</ItemsPanelTemplate>
			</ItemsControl.ItemsPanel>
			<ItemsControl.ItemTemplate>
				<DataTemplate DataType="{x:Type viewModels1:ConnectionViewModel}">
					<Path Stroke="Chocolate" StrokeThickness="1">
						<Path.Data>
							<LineGeometry
								StartPoint="{Binding StartNodeViewModel.Pos, Converter={StaticResource PointToCanvasConverter}}"
								EndPoint="{Binding EndNodeViewModel.Pos, Converter={StaticResource PointToCanvasConverter}}"/>
						</Path.Data>
					</Path>
				</DataTemplate>
			</ItemsControl.ItemTemplate>
		</ItemsControl>
		<ItemsControl Name="TechItemsControl" ItemsSource="{Binding TechTree}">
			<ItemsControl.ItemsPanel>
				<ItemsPanelTemplate>
					<Canvas x:Name="TechTreeCanvas" VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
									Width="2000" Height="1500"/>
				</ItemsPanelTemplate>
			</ItemsControl.ItemsPanel>
			<ItemsControl.ItemContainerStyle>
				<Style d:DataContext="{d:DesignInstance d:Type=viewModels1:TechNodeViewModel}">
					<Setter Property="Canvas.Left" Value="{Binding Pos.X, Converter={StaticResource PosXToCanvasConverter}}"/>
					<Setter Property="Canvas.Bottom" Value="{Binding Pos.Y, Converter={StaticResource PosYToCanvasConverter}}"/>
					<Setter Property="Canvas.ZIndex" Value="{Binding Zlayer}"/>
				</Style>
			</ItemsControl.ItemContainerStyle>
			<ItemsControl.ItemTemplate>
				<DataTemplate DataType="{x:Type viewModels1:TechNodeViewModel}">
					<Thumb Width="40" Height="40"
									DragDelta="TechNode_OnDragDelta"
									DragCompleted="Thumb_OnDragCompleted"
									DragStarted="Thumb_OnDragStarted">
						<Thumb.Template>
							<ControlTemplate>
								<Grid>
									<Rectangle Fill="CadetBlue"/>
									<Label Content="{Binding Icon[0]}"
													HorizontalAlignment="Center"
													VerticalAlignment="Center"/>
									<Rectangle Fill="Transparent" Cursor="Hand"/>
								</Grid>
							</ControlTemplate>
						</Thumb.Template>
					</Thumb>
				</DataTemplate>
			</ItemsControl.ItemTemplate>
		</ItemsControl>
	</Grid>
</UserControl>
